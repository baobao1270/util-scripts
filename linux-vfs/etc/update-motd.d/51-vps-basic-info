#!/bin/bash
# VPS Info Banner v1.3.3
# [LICENSE] MIT License / GPL 3.0+ / 01PL-2.0
# [INSTALL] curl https://lty.name/vpsinfo -o /etc/update-motd.d/51-vps-info && chmod +x /etc/update-motd.d/51-vps-info

LANG=en
#IP=$(curl -sf --connect-timeout 5 https://ncsi.josephcz.xyz/ip)
#IP=$(curl -sf --connect-timeout 5 http://169.254.169.254/latest/meta-data/public-ipv4)
IP=$(dig +time=5 +retry=1 +tries=1 +short $(cat /etc/hostname) @1.1.1.1)
# Fix for azure
#IP=$(curl -sf --connect-timeout 5 -H "Metadata: true" "http://169.254.169.254/metadata/instance/network/interface/0/ipv4/ipAddress/0/publicIpAddress?api-version=2017-08-01&format=text")
CPU=$(lscpu | grep "^Model name" | head -1 | cut -d":" -f2 | xargs)
NCPU=$(lscpu | grep "^CPU(s):" | head -1 | cut -d":" -f2 | xargs)

echo ""
echo "  CPU Model:     " "$CPU ($NCPU)"
echo "  Memory Usage:  " `free -m | grep Mem | awk '{print $3}'`MiB/`free -m | grep Mem | awk '{print $2}'`MiB
echo "  Swap Usage:    " `free -m | grep Swap | awk '{print $3}'`MiB/`free -m | grep Swap | awk '{print $2}'`MiB
echo "  Current Time:  " `date +"%Y-%m-%d %H:%M:%S %Z"`
if [ "$(uptime --version | grep -c procps)" == "0" ]; then
	# Fix for openSUSE
	echo "  Uptime:        " `uptime | cut -d, -f1 | cut -d" " -f5-`
else
	echo "  Boot Time:     " `uptime -s`
	echo "  Uptime:        " `uptime -p | cut -c4-`
fi
echo "  Public IP:     " "$IP"
echo "  Hostname:      " `[ -f /etc/hostname ] && cat /etc/hostname`
echo ""

